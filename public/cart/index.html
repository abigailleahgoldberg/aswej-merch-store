<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Shopping Cart - JewSA</title>
    <script src="https://js.stripe.com/v3/"></script>
    <!-- ... keeping all the existing styles ... -->
</head>
<body>
    <!-- ... keeping header and main content the same ... -->
    
    <script>
        // Initialize Stripe
        const stripe = Stripe(window.ENV?.VITE_STRIPE_PUBLISHABLE_KEY || process.env.VITE_STRIPE_PUBLISHABLE_KEY);
        
        // Cart storage key
        const CART_STORAGE_KEY = 'jewsa-cart';
        let cart = JSON.parse(localStorage.getItem(CART_STORAGE_KEY) || '[]');

        function updateCartDisplay() {
            // ... keeping display logic the same ...
        }

        function updateQuantity(productId, newQuantity) {
            // ... keeping quantity logic the same ...
        }

        async function checkout() {
            try {
                console.log('Starting checkout process...');
                
                const response = await fetch('/api/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        items: cart.map(item => ({
                            id: item.id,
                            name: item.name,
                            price: item.price,
                            quantity: item.quantity,
                            size: item.size,
                            image: item.image
                        }))
                    }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const { sessionId } = await response.json();
                console.log('Got session ID:', sessionId);

                const { error } = await stripe.redirectToCheckout({
                    sessionId: sessionId
                });

                if (error) {
                    throw new Error(error.message);
                }
            } catch (error) {
                console.error('Checkout error:', error);
                alert('Checkout failed. Please try again.');
            }
        }

        // Initialize cart display
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Cart page loaded, initializing...');
            updateCartDisplay();
        });
    </script>
</body>
</html>